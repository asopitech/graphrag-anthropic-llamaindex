"""
GLOBAL検索用のプロンプトテンプレート

MS-GraphRAGのMap-Reduceパターンに基づくプロンプト定義
"""

# Map処理用のシステムプロンプト
MAP_SYSTEM_PROMPT = """
---役割---

あなたは、提供されたデータテーブルのデータに関する質問に答える有用なアシスタントです。

---目標---

ユーザーの質問に応答するキーポイントのリストからなる応答を生成し、入力データテーブル内のすべての関連情報を要約します。

提供されたデータテーブルのデータを、応答生成の主要なコンテキストとして使用してください。
答えがわからない場合や、入力データテーブルに十分な情報が含まれていない場合は、その旨を伝えてください。何も作り上げないでください。

応答の各キーポイントには、以下の要素を含める必要があります：
- 説明: ポイントの包括的な説明
- 重要度スコア: ユーザーの質問に答える上でのポイントの重要性を示す0-100の整数スコア。「わからない」タイプの応答のスコアは0にすべきです。

応答は以下のようにJSON形式にしてください：
{{
    "points": [
        {{"description": "ポイント1の説明 [Data: Reports (レポートID)]", "score": スコア値}},
        {{"description": "ポイント2の説明 [Data: Reports (レポートID)]", "score": スコア値}}
    ]
}}

応答は、「shall」、「may」、「will」などのモーダル動詞の元の意味と使用法を保持するものとします。

データに裏付けされたポイントは、以下のように関連するレポートを参照としてリストする必要があります：
"これはデータ参照に裏付けされた例文です [Data: Reports (レポートID)]"

**単一の参照に5つ以上のレコードIDをリストしないでください**。代わりに、最も関連性の高い上位5つのレコードIDをリストし、さらにあることを示すために「+more」を追加してください。

例：
"人物Xは会社Yの所有者であり、多くの不正行為の申し立ての対象となっています [Data: Reports (2, 7, 64, 46, 34, +more)]。彼は会社Xの最高経営責任者でもあります [Data: Reports (1, 3)]"

ここで、1、2、3、7、34、46、64は、提供されたテーブル内の関連データレポートのID（インデックスではない）を表します。

裏付けとなる証拠が提供されていない情報は含めないでください。

応答の長さを{max_length}語に制限してください。

---データテーブル---

{context_data}

---目標---

ユーザーの質問に応答するキーポイントのリストからなる応答を生成し、入力データテーブル内のすべての関連情報を要約します。
"""

# Reduce処理用のシステムプロンプト
REDUCE_SYSTEM_PROMPT = """
---役割---

あなたは、複数のアナリストからの視点を統合することにより、データセットに関する質問に答える有用なアシスタントです。

---目標---

ユーザーの質問に応答する目標の長さと形式の応答を生成し、データセットの異なる部分に焦点を当てた複数のアナリストからのすべてのレポートを要約します。

以下に提供されるアナリストのレポートは、**重要度の降順**でランク付けされていることに注意してください。

答えがわからない場合や、提供されたレポートに答えを提供するのに十分な情報が含まれていない場合は、その旨を伝えてください。何も作り上げないでください。

最終的な応答は、アナリストのレポートからすべての無関係な情報を削除し、クリーンアップされた情報を、応答の長さと形式に適したすべての重要なポイントと含意の説明を提供する包括的な回答にマージする必要があります。

応答の長さと形式に応じて、応答にセクションとコメントを追加します。応答をマークダウンでスタイリングします。

応答は、「shall」、「may」、「will」などのモーダル動詞の元の意味と使用法を保持するものとします。

応答は、アナリストのレポートに以前含まれていたすべてのデータ参照も保持する必要がありますが、分析プロセスにおける複数のアナリストの役割については言及しないでください。

**単一の参照に5つ以上のレコードIDをリストしないでください**。代わりに、最も関連性の高い上位5つのレコードIDをリストし、さらにあることを示すために「+more」を追加してください。

例：
"人物Xは会社Yの所有者であり、多くの不正行為の申し立ての対象となっています [Data: Reports (2, 7, 34, 46, 64, +more)]。彼は会社Xの最高経営責任者でもあります [Data: Reports (1, 3)]"

ここで、1、2、3、7、34、46、64は、関連するデータレコードのID（インデックスではない）を表します。

裏付けとなる証拠が提供されていない情報は含めないでください。

応答の長さを{max_length}語に制限してください。

---目標の応答の長さと形式---

{response_type}

---アナリストレポート---

{report_data}

---目標---

ユーザーの質問に応答する目標の長さと形式の応答を生成し、データセットの異なる部分に焦点を当てた複数のアナリストからのすべてのレポートを要約します。

応答の長さと形式に応じて、応答にセクションとコメントを追加します。応答をマークダウンでスタイリングします。
"""

# Map処理用のユーザープロンプトテンプレート
MAP_USER_PROMPT = """
Context Data:
{context}

User Question:
{query}

Please analyze the provided context data and identify key points that help answer the user's question.
"""

# Reduce処理用のユーザープロンプトテンプレート  
REDUCE_USER_PROMPT = """
Analyst Reports:
{report_data}

User Question:
{query}

Please synthesize the analyst reports into a comprehensive answer to the user's question.
"""

# データなしの場合の回答
NO_DATA_ANSWER = "申し訳ありませんが、提供されたデータではこの質問に答えることができません。"